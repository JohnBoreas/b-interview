MySQL加锁逻辑：



判断是当前读还是快照读， 

判断是聚簇索引还是非聚簇索引

判断当前的事务级别是什么，是读已提交还是可重复读



快照读不需要锁，读的是快照，select都是快照读

当前读加锁，记录锁还是间隙锁看索引锁定的行数，索引类型



读已提交级别下都是快照读，只锁定查询到的具体行记录

可重复读下才会有间隙锁



可重复读条件下，

聚簇索引或者唯一索引查具体的某条记录，只会加记录锁

查的是一个范围，就会在聚簇索引上加记录锁跟间隙锁，在非聚簇索引上加记录锁



insert加意向排他锁，不阻塞不同主键id的插入

insert与on ducplicade区别是 insert在发现库里有同一条记录时加共享锁，on ducplicade是排它锁